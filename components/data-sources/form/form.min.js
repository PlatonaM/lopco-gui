
export{Form}
class Form{static api='http://localhost:8000/machine-registry/machines';static p_api='http://localhost:8000/pipeline-registry/pipelines';constructor(ctr){this.container=ctr;}
draw(ds_data=null){fetch(Form.p_api).then((response)=>{if(response.ok){return response.json()}
throw'Error retrieving pipelines - '+response.status;}).then((data)=>{fetch('/components/data-sources/form/template.html').then((response)=>response.text()).then((template)=>{let items=[];for(let[key,value]of Object.entries(data)){value=JSON.parse(value);items.push({p_id:key,p_name:value['name'],selected:(ds_data)?(key===ds_data['pipeline_id']):false})}
if(ds_data){this.container.innerHTML=Mustache.render(template,{pipelines:items,ds_id:ds_data['id'],ds_name:ds_data['name'],ds_type:ds_data['type_id']});}else{this.container.innerHTML=Mustache.render(template,{pipelines:items});}
let form=this.container.getElementsByTagName('form')[0];form.addEventListener('submit',this.submit)});}).catch((err)=>{this.container.innerHTML=err;});}
drawEdit(ds){fetch(Form.api+'/'+ds).then((response)=>{if(response.ok){return response.json()}
throw'Error retrieving Data-Source - '+response.status;}).then((data)=>{data['id']=ds;this.draw(data);}).catch((err)=>{this.container.innerHTML=err;});}
submit(event){event.preventDefault();const form=new FormData(event.target);fetch(Form.api+'/'+form.get('form-id'),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:form.get('form-name'),pipeline_id:form.get('form-pipeline'),type_id:form.get('form-type')}),}).then(response=>response.text()).then((data)=>{alert('Data-Source saved successfully!');window.open('/data-sources','_self');}).catch((error)=>{alert("Can't save Data-Source: "+error);});}}